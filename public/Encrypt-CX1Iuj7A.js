import{H as K,I as E,J as X,K as J,M as Z,U as F,V as ee,W as te,X as z,Y as ae,G as v,E as T,u as S,i as M,j as t,Z as W,D as B,$ as ne,F as O,a0 as se,a1 as _,a2 as re,a3 as oe,a4 as ie,q as le,a5 as de,r as R,a6 as ce,a7 as ue,a8 as D,a9 as L,T as ge,aa as me}from"./index-C81rsxZe.js";var pe=K?E.useLayoutEffect:E.useEffect;function A(e,s){var a=X(s==null?void 0:s.client);J(e,Z.Mutation);var o=E.useState({called:!1,loading:!1,client:a}),r=o[0],l=o[1],n=E.useRef({result:r,mutationId:0,isMounted:!0,client:a,mutation:e,options:s});pe(function(){Object.assign(n.current,{client:a,options:s,mutation:e})});var u=E.useCallback(function(d){d===void 0&&(d={});var b=n.current,c=b.options,x=b.mutation,g=F(F({},c),{mutation:x}),i=d.client||n.current.client;!n.current.result.loading&&!g.ignoreResults&&n.current.isMounted&&l(n.current.result={loading:!0,error:void 0,data:void 0,called:!0,client:i});var p=++n.current.mutationId,f=ee(g,d);return i.mutate(f).then(function(m){var y,w,P=m.data,N=m.errors,j=N&&N.length>0?new te({graphQLErrors:N}):void 0,I=d.onError||((y=n.current.options)===null||y===void 0?void 0:y.onError);if(j&&I&&I(j,f),p===n.current.mutationId&&!f.ignoreResults){var C={called:!0,loading:!1,data:P,error:j,client:i};n.current.isMounted&&!z(n.current.result,C)&&l(n.current.result=C)}var k=d.onCompleted||((w=n.current.options)===null||w===void 0?void 0:w.onCompleted);return j||k==null||k(m.data,f),m}).catch(function(m){var y;if(p===n.current.mutationId&&n.current.isMounted){var w={loading:!1,error:m,data:void 0,called:!0,client:i};z(n.current.result,w)||l(n.current.result=w)}var P=d.onError||((y=n.current.options)===null||y===void 0?void 0:y.onError);if(P)return P(m,f),{data:void 0,errors:m};throw m})},[]),h=E.useCallback(function(){if(n.current.isMounted){var d={called:!1,loading:!1,client:n.current.client};Object.assign(n.current,{mutationId:0,result:d}),l(d)}},[]);return E.useEffect(function(){var d=n.current;return d.isMounted=!0,function(){d.isMounted=!1}},[]),[u,F({reset:h},r)]}var G={};(function(e){Object.defineProperty(e,"__esModule",{value:!0});var s="fas",a="circle-info",o=512,r=512,l=["info-circle"],n="f05a",u="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM216 336l24 0 0-64-24 0c-13.3 0-24-10.7-24-24s10.7-24 24-24l48 0c13.3 0 24 10.7 24 24l0 88 8 0c13.3 0 24 10.7 24 24s-10.7 24-24 24l-80 0c-13.3 0-24-10.7-24-24s10.7-24 24-24zm40-208a32 32 0 1 1 0 64 32 32 0 1 1 0-64z";e.definition={prefix:s,iconName:a,icon:[o,r,l,n,u]},e.faCircleInfo=e.definition,e.prefix=s,e.iconName=a,e.width=o,e.height=r,e.ligatures=l,e.unicode=n,e.svgPathData=u,e.aliases=l})(G);const Y={"3840x2160":{width:3840,height:2160},"3200x1800":{width:3200,height:1800},"2880x1620":{width:2880,height:1620},"2560x1600":{width:2560,height:1600},"2560x1440":{width:2560,height:1440},"2048x1536":{width:2048,height:1536},"1920x1080":{width:1920,height:1080},"1680x1050":{width:1680,height:1050},"1600x900":{width:1600,height:900},"1366x768":{width:1366,height:768},"968x544":{width:968,height:544}};function U(e,s){if(!e)throw new Error("Canvas is not defined");const a=e.getContext("2d");if(!a)throw new Error("Failed to get canvas context");const o=e.width,r=e.height,n=a.getImageData(0,0,o,r).data;let u=r,h=o,d=0,b=0;for(let p=0;p<r;p++)for(let f=0;f<o;f++)n[(p*o+f)*4+3]>0&&(f<h&&(h=f),f>d&&(d=f),p<u&&(u=p),p>b&&(b=p));const c=d-h+1,x=b-u+1,g=document.createElement("canvas");g.width=c,g.height=x+50;const i=g.getContext("2d");if(!i)throw new Error("Failed to get trimmed canvas context");return i.imageSmoothingEnabled=!0,i.imageSmoothingQuality="high",s&&(i.font="normal 36px Tahoma",i.fontKerning="none",i.textRendering="geometricPrecision",i.fillStyle="#ffeedd",i.fillText("Decode this image at stegg.alifeinbinary.com",c-700,x+42)),i.putImageData(a.getImageData(h,u,c,x),0,0),Promise.resolve(g)}async function H(e,s,a){const o=new Image,r=URL.createObjectURL(await be(e));return o.src=r,new Promise((l,n)=>{o.onload=async()=>{const{width:u,height:h}=Y[s],d=o.width,b=o.height,c=document.createElement("canvas"),x=c.getContext("2d");await o.decode();let g=u,i=b/d*g;a==="download"&&i>h&&(i=h,g=d/b*i),a==="download"&&(g*=.9,i*=.9),c.width=u,c.height=a==="download"?h:i;const p=(c.width-g)/2,f=(c.height-i)/2;x.imageSmoothingEnabled=!0,x.imageSmoothingQuality="high",x.drawImage(o,p,f,g,i),URL.revokeObjectURL(r),c?l(c):n(new Error("Failed to create canvas"))},o.onerror=()=>{URL.revokeObjectURL(r),n(new Error("Failed to load image"))}})}function he(e,s){const a="save.saveToDisk: ",o=URL.createObjectURL(e);console.debug(a+"blobUrl: ",o),s?fetch(o).then(r=>r.blob()).then(r=>ae.saveAs(r,s)):console.error(a+"Failed to get filename")}async function fe(e,s,a){if(!e)throw new Error("Canvas is not defined");if(!e.getContext("2d"))throw new Error("Failed to get canvas context");const l=await(await new Promise((b,c)=>{e.toBlob(x=>{x?b(x):c(new Error("Failed to create blob"))},"image/png")})).arrayBuffer(),n=new Uint8Array(l),u=T.addMetadata(n,"Stegversion","1.0"),h=T.addMetadata(u,"Message",s),d=T.addMetadata(h,"Encrypted",a.toString());return Promise.resolve(new Blob([d]))}function xe(e,s){if(s){console.debug("save.createPngWithMetadata: Encrypted Text",s);const a=`alifeinbinary_com-${e?s.slice(7,15):Math.floor(Math.random()*1e4)}.png`;return Promise.resolve(a)}else throw new Error("No encrypted text provided")}function be(e){return new Promise((s,a)=>{e.toBlob(o=>{o?s(o):a(new Error("Failed to create blob"))},"image/png")})}function $(e,s,a,o,r,l,n){const u=o?r:l,h=c=>(v.update(n,{render:c,type:"error",isLoading:!1,autoClose:2e3}),new Error(c)),d=(c,x)=>{v.update(n,{render:c,type:"info",isLoading:!1,autoClose:2e3,progress:x})},b=async c=>{const x="save.handleMetadataAndResolve: ";if(!(c instanceof HTMLCanvasElement))throw h("Canvas is not a canvas");d("Adding metadata to image",.18);const g=await fe(c,u,o);if(console.debug(x+"canvasDimensions",c.width,c.height),!(g instanceof Blob))throw h("Payload is not a Blob");d("Creating filename",.2);const i=await xe(o,u);if(!i)throw h("No filename");return{payloadImage:g,filename:i,outputWidth:c.width,outputHeight:c.height}};return new Promise(async(c,x)=>{try{if(a==="download"){d("Trimming and scaling canvas",.14);const g=await U(e,!1),i=await H(g,s,a),{payloadImage:p,filename:f}=await b(i);d("Saving image to disk",1),he(p,f)}else if(a==="post"){d("Scaling canvas",.14);const g=await U(e,!0),i=await H(g,s,a);console.debug("save.createPngWithMetadata: scaledCanvas",i);const{payloadImage:p,filename:f,outputWidth:m,outputHeight:y}=await b(i);d("Returning payload for post",.22),c({payloadImage:p,filename:f,outputWidth:m,outputHeight:y})}else throw h("Invalid action")}catch(g){x(g)}})}const ye=()=>{const{t:e}=S(),{canvasRef:s,input:a,setInput:o,setOutput:r,encryptionEnabled:l,setEncryptionEnabled:n,password:u,setPassword:h,encryptedText:d,setEncryptedText:b,setDecryptedText:c}=M(),x=()=>l?!u||!a:!(a.length>0),g=async i=>{const p="download",f=v("Saving...",{autoClose:!1,isLoading:!0});if(s&&s.current&&a){const m=s.current;await $(m,i,p,l,d,a,f),_(s)}o(""),h(""),b(""),c(""),n(!1),r([])};return t.jsx(t.Fragment,{children:t.jsxs(W,{content:a.length?e("downloadimagebutton.tooltip.title"):e("downloadimagebutton.tooltip.hint"),placement:"top-start",trigger:"hover",children:[t.jsx("label",{htmlFor:"btn-download",className:"sr-only",children:e("downloadimagebutton.label")}),t.jsxs(B,{theme:ne,id:"btn-download",disabled:!a.length,tabIndex:0,placement:"bottom-start",dismissOnClick:!0,className:`inline-flex items-center justify-center rounded-lg text-center text-sm font-medium transition duration-300 ease-in-out dark:hover:bg-slate-800 ${x()?"cursor-not-allowed bg-gray-200/[0.5] text-gray-600 hover:ring-transparent focus:ring-0":"bg-gray-100 text-white focus:ring-4 dark:bg-slate-800 dark:text-slate-900"}`,label:t.jsxs(t.Fragment,{children:[t.jsx(O,{icon:se}),t.jsx("span",{className:"sr-only",children:e("downloadimagebutton.label")})]}),children:[t.jsx(B.Header,{children:"Select dimensions"}),Object.keys(Y).map(i=>t.jsx(B.Item,{onClick:()=>{g(i)},children:i.replace("x"," x ")},i))]})]})})},ve=()=>{const{t:e}=S(),[s,a]=M(r=>[r.size,r.setSize]);function o(r){a(Math.floor(Number(r.target.value)))}return t.jsxs("div",{className:"relative lg:w-60 md:w-40 sm:w-48 mb-6 mx-3",children:[t.jsx("label",{htmlFor:"labels-range-input",className:"xs:sr-only text-left block mb-0 text-xs font-medium text-gray-900 dark:text-white",children:e("nodesize.label")}),t.jsx("input",{id:"labels-range-input",tabIndex:0,type:"range",min:"36",max:"66",value:s,step:"10",onChange:r=>o(r),className:"w-full h-1 mb-1 range-sm text-blue-900 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700"}),t.jsx("span",{className:"text-xs uppercase text-gray-500 dark:text-gray-400 absolute start-0 -bottom-4",children:"sm"}),t.jsx("span",{className:"text-xs uppercase text-gray-500 dark:text-gray-400 absolute start-1/3 -translate-x-1/2 rtl:translate-x-1/2 -bottom-4",children:"md"}),t.jsx("span",{className:"text-xs uppercase text-gray-500 dark:text-gray-400 absolute start-2/3 -translate-x-1/2 rtl:translate-x-1/2 -bottom-4",children:"lg"}),t.jsx("span",{className:"text-xs uppercase text-gray-500 dark:text-gray-400 absolute end-0 -bottom-4",children:"xl"})]})},we=()=>{const[e]=A(re,{context:{apiName:"main"}});return{createBinaryFeedImage:async a=>(await e({variables:{data:a}}),new Promise(o=>{o({})}))}},je=()=>{const[e]=A(oe,{context:{apiName:"manage"}}),[s]=A(ie,{context:{apiName:"manage"}});return{createBinaryImagePost:async(r,l,n,u)=>{const h=Date.now(),d=new Date(h).toISOString();return console.log("width",n,"height",u),(await e({variables:{author:r,image:l,posted:d,width:n,height:u}})).data.createBinaryImagePost.data.id},publishBinaryImagePost:async r=>s({variables:{id:r,meta:{status:"published"}}})}},Ie=()=>{const{refetch:e}=le(de,{context:{apiName:"main"}});return{getPreSignedPostPayload:async a=>e({data:{name:a.name,type:a.type,size:a.size}})}},Ee=(e,s)=>(console.debug("presignedPostData",e),console.debug("Uploading file to S3..."),new Promise((a,o)=>{const r=new FormData;Object.keys(e.data.fields).forEach(n=>{r.append(n,e.data.fields[n])}),r.append("file",s);const l=new XMLHttpRequest;l.open("POST",e.data.url,!0),l.send(r),l.onload=function(){if(l.status===204)return a(l.response),console.debug("File uploaded successfully",l.response),l.response.url;o(l.response),console.error("File upload failed:",l.response)}})),Pe=()=>{const{t:e}=S(),[s,a]=R.useState(""),{canvasRef:o,input:r,password:l,encryptedText:n,encryptionEnabled:u,setOutput:h}=M(),{getPreSignedPostPayload:d}=Ie(),{createBinaryFeedImage:b}=we(),{createBinaryImagePost:c,publishBinaryImagePost:x}=je(),g=()=>u?!r||!l:!u,i=async p=>{p.preventDefault();const f="post",m=v(e("postimagebutton.toast.processing"),{autoClose:!1,isLoading:!0});if(o&&o.current&&r){if(u){v.update(m,{render:e("postimagebutton.toast.embedding"),type:"info",isLoading:!1,autoClose:2e3,progress:0});const{payloadImage:y,filename:w,outputWidth:P,outputHeight:N}=await $(o.current,"968x544",f,u,n,r,m);console.debug("fileName",w,"url",y),v.update(m,{render:e("postimagebutton.toast.size"),type:"info",isLoading:!1,autoClose:2e3,progress:.14}),console.debug("blob",y,"size",y.size),v.update(m,{render:e("postimagebutton.toast.presignedpayload"),type:"info",isLoading:!1,autoClose:2e3,progress:.28});const{data:j}=await d({name:w,type:"image/png",size:y.size});console.debug("data",j),v.update(m,{render:e("postimagebutton.toast.uploading"),type:"info",isLoading:!1,autoClose:2e3,progress:.42});const I=j==null?void 0:j.fileManager.getPreSignedPostPayload.data;console.debug("preSignedPostPayload",I),await Ee(I,y);const C={...I.file,tags:["binary-image"],aliases:[],location:{folderId:"66dab7609c00420008532f90#0001"}};delete C.__typename,console.debug("fileInput",C),v.update(m,{render:e("postimagebutton.toast.createimage"),type:"info",isLoading:!1,autoClose:2e3,progress:.57});const k=await b(C);console.debug("createdFile",k),v.update(m,{render:e("postimagebutton.toast.createimagepost"),type:"info",isLoading:!1,autoClose:2e3,progress:.71});const q=s||"Anon",Q="https://dj8rv0ejdatzv.cloudfront.net/files/"+I.file.key,V=await c(q,Q,P,N);console.debug("Binary image post created."),v.update(m,{type:"info",render:e("postimagebutton.toast.publishing"),isLoading:!1,autoClose:2e3,progress:.85}),await x(V),console.debug("Image published successfully!"),v.update(m,{type:"success",render:e("postimagebutton.toast.success"),isLoading:!1,autoClose:2e3,progress:1})}else console.debug("Encryption disabled"),v.update(m,{type:"warning",render:e("postimagebutton.toast.noencryption"),isLoading:!1,autoClose:2e3});_(o),h([])}else console.debug("No canvasRef or input"),v.update(m,{type:"warning",render:e("postimagebutton.toast.nocanvasorinput"),isLoading:!1,autoClose:2e3})};return t.jsxs("div",{tabIndex:0,className:"shadow-card p-1 flex h-[46px] items-center justify-center rounded-md text-gray-900 bg-gray-200 dark:bg-seablue",children:[t.jsx("input",{onChange:p=>{a(p.target.value)},"data-testid":"user-input",value:s,type:"text",tabIndex:0,id:"user-input",disabled:!1,className:`text-base rounded-none rounded-l-lg max-w-40 bg-gray-100 dark:bg-gray-100 border text-gray-900 focus:ring-transparent focus:border-transparent block flex-1 min-w-0 transition-width ease-in-out duration-1000 ${g()?"w-0 px-0 py-2.5":"w-full p-2.5"} border-gray-200 focus:border-gray-200 dark:bg-gray-200 dark:border-seablue dark:placeholder-gray-400 dark:text-gray-900 dark:focus:ring-none dark:focus:border-none`,placeholder:"Author Name"}),t.jsx(W,{content:l.length&&r.length?e("postimagebutton.tooltip.posttofeed"):e("postimagebutton.tooltip.entermessage"),placement:"bottom",children:t.jsxs("button",{onClick:p=>{i(p)},disabled:!l.length||!r.length,className:`flex p-2 h-full w-24 ml-1 items-center justify-center transition ease-in-out duration-300 rounded text-base ${g()?"cursor-not-allowed text-gray-600 bg-gray-200/[0.5] focus:ring-0 hover:ring-transparent":"text-white bg-sagegreen/[0.8] hover:bg-sagegreen/[1.0] focus:ring-blue-200 focus:ring-4"}`,children:[e("postimagebutton.label")," ",t.jsx(O,{icon:ce,className:"w-4 h-4 pl-2","aria-hidden":"true"})]})})]})},Ne=()=>{const[e,s]=R.useState(!1),{t:a}=S(),{input:o,setInput:r,setOutput:l,password:n,setPassword:u,encryptionEnabled:h,setEncryptionEnabled:d,setEncryptedText:b,decryptedText:c,setDecryptedText:x,stringToDecrypt:g,setStringToDecrypt:i}=M(),p=R.useRef(null),f={color:{primary:"bg-none"},base:"flex-none",inner:{base:"px-0"}};return t.jsxs("div",{className:"w-full",children:[t.jsx("span",{className:"flex flex-row justify-between pt-2 text-white",children:t.jsxs("div",{className:"grid w-full grid-cols-2 xs:grid-cols-2",children:[t.jsx("h4",{className:"h4 sm:visible md:visible lg:visible mb-2 text-left text-2xl font-bold xs:invisible dark:text-white",children:a("encrypt.title")}),t.jsx("p",{className:"col-span-1 flex flex-row-reverse text-right font-medium xs:mr-0 xs:pb-2 xs:text-right",children:t.jsx(ue,{onClick:()=>s(!0),theme:f,color:"primary",type:"button","aria-label":a("encrypt.modal.title"),children:t.jsx(O,{icon:G.faCircleInfo,className:"tranistion-colors ml-1 text-lg text-seablue duration-300 ease-linear hover:text-white"})})})]})}),t.jsxs(D,{show:e,onClose:()=>s(!1),children:[t.jsx(D.Header,{children:a("encrypt.modal.title")}),t.jsxs(D.Body,{children:[t.jsx("div",{className:"space-y-6",children:t.jsx("div",{className:"text-base leading-relaxed",children:t.jsxs(L,{children:[t.jsx(L.Item,{className:"text-gray-700 dark:text-gray-100",children:a("encrypt.modal.step1")}),t.jsx(L.Item,{className:"text-gray-700 dark:text-gray-100",children:a("encrypt.modal.step2")})]})})}),t.jsx("h5",{className:"text-md mt-5 font-bold text-gray-800 dark:text-gray-200",children:a("encrypt.modal.caveatstitle")}),t.jsx("p",{className:"mt-1 text-sm leading-relaxed text-gray-700 dark:text-gray-100",children:a("encrypt.modal.caveatstext")}),t.jsx("h5",{className:"text-md mt-5 font-bold text-gray-800 dark:text-gray-200",children:a("encrypt.modal.securitytitle")}),t.jsx("p",{className:"mt-1 text-sm leading-relaxed text-gray-700 dark:text-gray-100",children:t.jsxs(ge,{i18nKey:"encrypt.modal.securitytext",components:{i:t.jsx("i",{})},children:["Images shared to the feed are stored on a server until they are deleted or expire, however, the plain text message is never sent to our servers. All encryption is calculated by your web browser, so only the encrypted message is stored to the image's metadata, which",t.jsx("i",{children:"is"})," temporarily hosted on our servers. This novel app is meant for educational and entertainment purposes. That being said, it uses 128-bit AES encryption, so it's about as secure as you can get."]})})]})]}),t.jsx("form",{className:"h-full min-h-48",children:t.jsxs("div",{className:"sm:mb-0 sm:rounded-none sm:rounded-t-lg mb-4 min-h-48 w-full rounded-lg border border-gray-200 bg-gray-50 dark:border-gray-600 dark:bg-slate-900 xs:mb-0 xs:rounded-none xs:rounded-t-lg",children:[t.jsxs("div",{className:"flex items-center justify-between border-b px-3 py-2 dark:border-slate-700",children:[t.jsx("div",{className:"sm:divide-x sm:rtl:divide-x-reverse flex flex-wrap items-center divide-gray-200 dark:divide-gray-600",children:t.jsx("div",{className:"sm:ps-4 flex flex-wrap items-center space-x-1 rtl:space-x-reverse",children:t.jsx(ye,{})})}),t.jsx(ve,{}),t.jsx("div",{className:"sm:w-56 flex",children:t.jsx(me,{password:n,setPassword:u,setEncryptedText:b,encryptionEnabled:h,setEncryptionEnabled:d,setOutput:l,decryptedText:c,setDecryptedText:x,stringToDecrypt:g,setStringToDecrypt:i})})]}),t.jsx("div",{className:"light:bg-white px-4 py-2 dark:bg-slate-700",children:t.jsx("textarea",{rows:4,id:"text-input",value:o,onChange:m=>{r(m.target.value),m.target.value.trim()===""&&(b(""),_(p),l([]))},"data-testid":"text-input",maxLength:254,tabIndex:0,className:"block h-full min-h-28 w-full border-0 bg-white px-0 text-base text-gray-800 focus:ring-0 dark:!bg-slate-700 dark:text-white dark:placeholder-gray-400",placeholder:`${c||a("encrypt.placeholder")}`,required:!0})}),t.jsx("div",{className:"flex items-center justify-end border-b px-3 py-2 dark:border-gray-600",children:t.jsx("div",{className:"sm:divide-x sm:rtl:divide-x-reverse flex flex-wrap items-center divide-gray-200 dark:divide-gray-600",children:t.jsx("div",{className:"sm:ps-4 flex flex-wrap items-center space-x-1 rtl:space-x-reverse",children:t.jsx(Pe,{})})})})]})})]})};export{Ne as default};
//# sourceMappingURL=Encrypt-CX1Iuj7A.js.map
